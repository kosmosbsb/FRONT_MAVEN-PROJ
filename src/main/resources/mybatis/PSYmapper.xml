<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- sql 매핑하기 (Comment.xml, OneMemo.xml 참고) -->

<mapper namespace="mybatis.PSYmapper"> 
	<select id="psySelectList" resultType="PsyTestDTO">
		select S.SPACE_NAME, H.H_NICKNAME, S.IMG_MAIN, S.SPACE_NO FROM  SPACE S INNER JOIN USER_HOST H on S.id= H.id
	</select>
	<select id="reserveView" resultType="PsyTestDTO">
		select R.RESERVE_NO, R.REGIDATE, S.SPACE_NAME, R.RESERVE_PERSON, R.ASK, R.startDate, R.ENDDATE from RESERVE R INNER JOIN SPACE S on R.SPACE_NO = S.SPACE_NO
		where R.reserve_no=#{rn}
	</select>
	<select id="reserveViewReserver" resultType="PsyTestDTO">
		select R.RESERVE_NAME, R.RESERVE_PHONE, R.RESERVE_EMAIL from RESERVE R inner join USER_NORMAL N on R.id = N.id
		where R.reserve_no=#{rn}
	</select>
	<select id="reserveViewRefund" resultType="PsyTestDTO">
		select SR.LEFTDAY8, SR.LEFTDAY7, SR.LEFTDAY6, SR.LEFTDAY5, SR.LEFTDAY4, SR.LEFTDAY3, SR.LEFTDAY2, SR.LEFTDAY1, SR.LEFTDAY0 from SPACE_REFUND SR inner join SPACE S on SR.SPACE_NO = S.SPACE_NO
		where S.SPACE_NO=#{sn}
	</select>
	<select id="reserveViewSpace" resultType="PsyTestDTO">
		select space_name, address, phone from space 
		where space_no=#{sn}
	</select>
	<select id="reserveViewMoney" resultType="PsyTestDTO">
		select R.RESERVE_NO, RC.cancel_comment,  R.startDate, R.ENDDATE , R.RESERVE_PERSON, RC.cancel_price from reserve_cancel RC inner join RESERVE R on RC.reserve_no = R.reserve_no 
		where RC.reserve_no=#{rn}
	</select>
	<select id="reserveLoginlist" resultType="PsyTestDTO">
		select S.space_name, H.H_NICKNAME, S.IMG_MAIN, R.RESERVE_NO, S.SPACE_NO
		from USER_HOST H 
		INNER JOIN SPACE S on H.id = S.id
		inner join reserve R on S.SPACE_NO = R.SPACE_NO
		inner join user_normal N on R.id = N.id
		where N.N_NICKNAME = #{nickname}
	</select>
	<insert id="reserveCancel" parameterType="PsyTestDTO">
	insert into reserve_cancel values(#{reserve_no},#{cancel_price},#{cancel_comment})
	</insert>
	<insert id="reserveInsert" parameterType="PsyTestDTO">
	INSERT INTO RESERVE values(
	SEQ_RESERVE.NEXTVAL,
	#{reserve_name},
	#{reserve_phone},
	#{reserve_email},
	'2',
	#{reserve_person},
	default,
	#{ask},
	#{space_no},
	(select id from user_normal where n_nickname=#{reserve_name}), 
	#{startdate}, 
	#{enddate}
	)
	</insert>
	<select id="reserveTest" resultType="PsyTestDTO">
		select S.SPACE_NO, R.reserve_no from space S inner join reserve R on S.space_no = R.space_no where R.id=(select id from user_normal where N_NICKNAME = #{nickname})
	</select>
</mapper>